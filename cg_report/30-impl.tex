\chapter{Технологическая часть}

В данном разделе представлено обоснование выбранных средств программной реализации, описаны основные моменты программной реализации и методики тестирования.

\section{Средства реализации}

В качестве языка программирования для реализации курсовой работы был выбран язык C++ с использованием OpenGL Framework и Qt Framework, так как язык C++ предоставляет необходимые средства для реализации выбранных в результате проектирования алгоритмов. OpenGL Framework используется для организации вычислений на графическом процессоре.

В качестве среды разработки выбрана Qt Creator, так как она поддерживает язык C++ и имеет встроенные средства для создания пользовательского интерфейса.

Для тестирования компонент программного обеспечения был выбран модуль Qt Test, так как он интегрирован в Qt Framework и не требует установки дополнительного программного обеспечения.

\section{Реализация алгоритмов}

В листинге \ref{lst:init} приведена инициализация окна OpenGL. В функции initializeGL с помощью вызова функции glEnable с параметром GL\_DEPTH\_TEST включается тест на глубину, то есть сравнение глубины текущей точки полигона и значения в буфере глубины. Также присутствует вызов функции glEnable с параметром GL\_CULL\_FACE для удаления невидимых задних граней.

\pagebreak

\begin{lstinputlisting}[
	caption={Инициализация opengl-окна},
	label={lst:init},
	style={cpp},
	linerange={99-115},
	]{/home/nastya/cg-course-work/sphere-mov-viz/glwidget.cpp}
\end{lstinputlisting}

В листинге \ref{lst:paint} приведена реализация метода отрисовки кадра OpenGL.

\begin{lstinputlisting}[
	caption={Отрисовка кадра},
	label={lst:paint},
	style={cpp},
	linerange={177-199},
	]{/home/nastya/cg-course-work/sphere-mov-viz/glwidget.cpp}
\end{lstinputlisting}

В строках 3-4 происходит расчёт карт теней.

В листингах \ref{lst:vert1}--\ref{lst:frag2} приведены основные вершинный и фрагментный шейдеры, участвующие в отрисовке изображения. Фрагментный шейдер обеспечивает закраску пикселей в соответствии с выбранными алгоритмами.

\begin{lstinputlisting}[
	caption={Вершинный шейдер},
	label={lst:vert1},
	style={cpp},
	linerange={1-30},
	]{/home/nastya/cg-course-work/sphere-mov-viz/vert.vsh}
\end{lstinputlisting}

\pagebreak

\begin{lstinputlisting}[
	caption={Фрагментный шейдер},
	label={lst:frag1},
	style={cpp},
	linerange={1-47},
	]{/home/nastya/cg-course-work/sphere-mov-viz/frag.fsh}
\end{lstinputlisting}

\begin{lstinputlisting}[
	caption={Продолжение листинга \ref{lst:frag2}},
	label={lst:frag2},
	style={cpp},
	linerange={48-78},
	]{/home/nastya/cg-course-work/sphere-mov-viz/frag.fsh}
\end{lstinputlisting}

В листингах \ref{lst:shadow}--\ref{lst:shadow3} представлены листинги шейдеров, создающих карты теней.

\begin{lstinputlisting}[
	caption={Вершинный шейдер для создания карты теней},
	label={lst:shadow},
	style={cpp},
	linerange={1-7},
	]{/home/nastya/cg-course-work/sphere-mov-viz/shadows.vsh}
\end{lstinputlisting}

\begin{lstinputlisting}[
	caption={Продолжение листинга \ref{lst:shadow}},
	label={lst:shadow2},
	style={cpp},
	linerange={8-11},
	]{/home/nastya/cg-course-work/sphere-mov-viz/shadows.vsh}
\end{lstinputlisting}

\begin{lstinputlisting}[
	caption={Фрагментный шейдер для создания карты теней},
	label={lst:shadow3},
	style={cpp},
	]{/home/nastya/cg-course-work/sphere-mov-viz/shadows.fsh}
\end{lstinputlisting}

В листинге \ref{lst:shadcreate} приведена функция, создающая текстуры, содержащие карты теней.

\begin{lstinputlisting}[
	caption={Создание текстур карт теней},
	label={lst:shadcreate},
	style={cpp},
	linerange={74-92},
	]{/home/nastya/cg-course-work/sphere-mov-viz/glwidget.cpp}
\end{lstinputlisting}

\section{Тестирование}

В курсовом проекте было реализовано модульное тестирование отдельных компонент разработанного программного обеспечения. 

В качестве примера модульных тестов можно рассмотреть класс \code{CameraTest}.

В листингах \ref{lst:camtest1} --- \ref{lst:camtest2} приведёны данный класс и пример модульного теста.

\begin{lstinputlisting}[
	caption={Класс, тестирующий камеру},
	label={lst:camtest1},
	style={cpp},
	linerange={5-17},
	]{/home/nastya/cg-course-work/sphere-mov-viz/testing/UnitTesting/tst_cameratest.cpp}
\end{lstinputlisting}

\begin{lstinputlisting}[
	caption={Пример теста},
	label={lst:camtest2},
	style={cpp},
	linerange={38-45},
	]{/home/nastya/cg-course-work/sphere-mov-viz/testing/UnitTesting/tst_cameratest.cpp}
\end{lstinputlisting}

Результат прохождения тестов представлен в листинге \ref{lst:res}:
\pagebreak
\begin{lstinputlisting}[
	caption={Результат прохождения тестов},
	label={lst:res},
	style={cpp},
	]{/home/nastya/cg-course-work/cg_report/inc/lst/lst2.txt}
\end{lstinputlisting}

\section{Описание интерфейса программы}

Демонстрация интерфейса программы приведена на рисунке \ref{img:int}.

\img{100mm}{int}{Демонстрация интерфейса программы}

Приложение можно запустить двумя способами: через среду Qt Creator или через терминал, выполнив команды \code{qmake}, \code{make} и \code{./sphere-mov-viz}.

При запуске приложения визуализация запускается со значениями параметров по умолчанию.

Оптические свойства объектов можно варьировать с помощью полей ввода со спиннером, скорость шарика также регулируется с помощью данных полей ввода.

Чтобы изменить текстуры шарика и качелей, необходимо нажать на кнопки, представленные на рисунке \ref{img:but1}.

\img{40mm}{but1}{Кнопки выбора текстур}

Нажатие первых двух кнопок, представленных на рисунке \ref{img:but1}, приводит к появлению окна выбора текстуры --- рисунок \ref{img:choice1}.

\img{100mm}{choice1}{Окно выбора текстуры}

Добавление и удаление источника света происходит с помощью кнопок, представленных на рисунке \ref{img:but2}.

\img{20mm}{but2}{Кнопки добавления и удаления источника света}
\pagebreak

Нажатие на кнопку выбора цвета фона приводит к появлению соответствующего окна --- рисунок \ref{img:choice2}.

\img{100mm}{choice2}{Окно выбора цвета фона}

Нажатие кнопки, отвечающей за добавление источника, приводит к появлению окна для ввода значений --- рисунок \ref{img:w3}.

\img{70mm}{w3}{Окно ввода значений}
\pagebreak

Удаление источника света производится нажатием на соответствующую строку таблицы и нажатием кнопки «Удалить источник».

\section*{Вывод}

В данном разделе были выбраны средства реализации, приведены листинги кода и был описан интерфейс программы.
